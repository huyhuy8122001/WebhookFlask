import re
import json
import requests

request_data = b'{"mautic.form_on_submit":[{"submission":{"id":992,"ipAddress":{"ipAddress":"2001:ee0:d748:6240:153:a9e4:4ea2:620","id":45900,"ipDetails":{"city":"Ho Chi Minh City","region":"Ho Chi Minh","zipcode":null,"country":"Vietnam","latitude":10.822,"longitude":106.6257,"isp":"","organization":"","timezone":"Asia\\/Ho_Chi_Minh","extra":""}},"form":{"id":41,"name":"Form \\u0111\\u0103ng k\\u00fd \\u1ee9ng tuy\\u1ec3n","alias":"ung_tuyen","category":null},"lead":{"id":332757,"points":0,"color":null,"fields":{"core":{"thiet_bi_dau_cuoi":{"id":61,"group":"core","label":"Thi\\u1ebft b\\u1ecb \\u0111\\u1ea7u cu\\u1ed1i","alias":"thiet_bi_dau_cuoi","type":"text","properties":[],"value":null,"normalizedValue":null},"vai_tro":{"id":60,"group":"core","label":"Vai tr\\u00f2","alias":"vai_tro","type":"multiselect","properties":{"list":[{"label":"Ng\\u01b0\\u1eddi quy\\u1ebft","value":"Ng\\u01b0\\u1eddi quy\\u1ebft"},{"label":"Ng\\u01b0\\u1eddi quy\\u1ebft &#38; duy\\u1ec7t","value":"Ng\\u01b0\\u1eddi quy\\u1ebft &#38; duy\\u1ec7t"},{"label":"Ng\\u01b0\\u1eddi duy\\u1ec7t","value":"Ng\\u01b0\\u1eddi duy\\u1ec7t"},{"label":"Ng\\u01b0\\u1eddi x\\u00e9t","value":"Ng\\u01b0\\u1eddi x\\u00e9t"},{"label":"Ng\\u01b0\\u1eddi d\\u00f9ng","value":"Ng\\u01b0\\u1eddi d\\u00f9ng"}]},"value":null,"normalizedValue":""},"cv1":{"id":59,"group":"core","label":"CV1","alias":"cv1","type":"url","properties":[],"value":null,"normalizedValue":null},"vitriungtuyen":{"id":58,"group":"core","label":"V\\u1ecb tr\\u00ed \\u1ee9ng tuy\\u1ec3n","alias":"vitriungtuyen","type":"text","properties":[],"value":null,"normalizedValue":null},"cv":{"id":56,"group":"core","label":"CV","alias":"cv","type":"text","properties":[],"value":null,"normalizedValue":null},"comment":{"id":55,"group":"core","label":"Comment","alias":"comment","type":"text","properties":[],"value":null,"normalizedValue":null},"full_name":{"id":53,"group":"core","label":"Full Name","alias":"full_name","type":"text","properties":[],"value":"Nguy\\u1ec5n Quang Huy Test","normalizedValue":"Nguy\\u1ec5n Quang Huy Test"},"role":{"id":52,"group":"core","label":"Role","alias":"role","type":"select","properties":{"list":[{"label":"Individual Contributor","value":"Individual Contributor"},{"label":"Manager","value":"Manager"},{"label":"Director","value":"Director"},{"label":"Executive","value":"Executive"},{"label":"Consultant","value":"Consultant"}]},"value":null,"normalizedValue":null},"nps__recommend":{"id":51,"group":"core","label":"NPS - Recommend","alias":"nps__recommend","type":"number","properties":{"roundmode":"3","scale":""},"value":null,"normalizedValue":null},"products":{"id":50,"group":"core","label":"Products","alias":"products","type":"select","properties":{"list":[{"label":"CCALL PRO","value":"CCALL PRO"},{"label":"CCALL Business","value":"CCALL Business"},{"label":"special","value":"special"},{"label":"12 thang","value":"12 thang"},{"label":"24 thang","value":"24 thang"}]},"value":null,"normalizedValue":null},"date_last_active":{"id":48,"group":"core","label":"Date Last Active","alias":"date_last_active","type":"datetime","properties":[],"value":null,"normalizedValue":null},"haspurchased":{"id":47,"group":"core","label":"hasPurchased","alias":"haspurchased","type":"boolean","properties":{"no":"No","yes":"Yes"},"value":null,"normalizedValue":null},"subscription_status":{"id":46,"group":"core","label":"Subscription Status","alias":"subscription_status","type":"select","properties":{"list":[{"label":"New","value":"New"},{"label":"Existing","value":"Existing"},{"label":"Former","value":"Former"}]},"value":null,"normalizedValue":null},"prospect_or_customer":{"id":45,"group":"core","label":"Prospect or Customer","alias":"prospect_or_customer","type":"select","properties":{"list":[{"label":"Prospect","value":"Prospect"},{"label":"Customer","value":"Customer"}]},"value":null,"normalizedValue":null},"b2b_or_b2c":{"id":44,"group":"core","label":"B2B or B2C","alias":"b2b_or_b2c","type":"select","properties":{"list":[{"label":"B2B","value":"B2B"},{"label":"B2C","value":"B2C"}]},"value":null,"normalizedValue":null},"title":{"id":1,"group":"core","label":"Title","alias":"title","type":"lookup","properties":{"list":["Mr","Mrs","Miss"]},"value":null,"normalizedValue":null},"firstname":{"id":2,"group":"core","label":"First Name","alias":"firstname","type":"text","properties":[],"value":null,"normalizedValue":null},"lastname":{"id":3,"group":"core","label":"Last Name","alias":"lastname","type":"text","properties":[],"value":null,"normalizedValue":null},"company":{"id":4,"group":"core","label":"Primary company","alias":"company","type":"text","properties":[],"value":null,"normalizedValue":null},"position":{"id":5,"group":"core","label":"Position","alias":"position","type":"text","properties":[],"value":null,"normalizedValue":null},"email":{"id":6,"group":"core","label":"Email","alias":"email","type":"email","properties":[],"value":"nguyenquanghuytest@gmail.com","normalizedValue":"nguyenquanghuytest@gmail.com"},"mobile":{"id":7,"group":"core","label":"Mobile","alias":"mobile","type":"tel","properties":[],"value":null,"normalizedValue":null},"phone":{"id":8,"group":"core","label":"Phone","alias":"phone","type":"tel","properties":[],"value":"0889920132","normalizedValue":"0889920132"},"points":{"id":9,"group":"core","label":"Points","alias":"points","type":"number","properties":[],"value":null,"normalizedValue":null},"fax":{"id":10,"group":"core","label":"Fax","alias":"fax","type":"tel","properties":[],"value":null,"normalizedValue":null},"address1":{"id":11,"group":"core","label":"Address Line 1","alias":"address1","type":"text","properties":[],"value":null,"normalizedValue":null},"address2":{"id":12,"group":"core","label":"Address Line 2","alias":"address2","type":"text","properties":[],"value":null,"normalizedValue":null},"city":{"id":13,"group":"core","label":"City","alias":"city","type":"text","properties":[],"value":null,"normalizedValue":null},"state":{"id":14,"group":"core","label":"State","alias":"state","type":"region","properties":[],"value":null,"normalizedValue":null},"zipcode":{"id":15,"group":"core","label":"Zip Code","alias":"zipcode","type":"text","properties":[],"value":null,"normalizedValue":null},"country":{"id":16,"group":"core","label":"Country","alias":"country","type":"country","properties":[],"value":null,"normalizedValue":null},"preferred_locale":{"id":17,"group":"core","label":"Preferred Locale","alias":"preferred_locale","type":"locale","properties":[],"value":null,"normalizedValue":null},"timezone":{"id":18,"group":"core","label":"Preferred Timezone","alias":"timezone","type":"timezone","properties":[],"value":null,"normalizedValue":null},"last_active":{"id":19,"group":"core","label":"Date Last Active","alias":"last_active","type":"datetime","properties":[],"value":null,"normalizedValue":null},"attribution_date":{"id":20,"group":"core","label":"Attribution Date","alias":"attribution_date","type":"datetime","properties":[],"value":null,"normalizedValue":null},"attribution":{"id":21,"group":"core","label":"Attribution","alias":"attribution","type":"number","properties":{"roundmode":4,"scale":2},"value":null,"normalizedValue":null},"website":{"id":22,"group":"core","label":"Website","alias":"website","type":"url","properties":[],"value":null,"normalizedValue":null}},"social":{"facebook":{"id":23,"group":"social","label":"Facebook","alias":"facebook","type":"text","properties":[],"value":null,"normalizedValue":null},"foursquare":{"id":24,"group":"social","label":"Foursquare","alias":"foursquare","type":"text","properties":[],"value":null,"normalizedValue":null},"instagram":{"id":25,"group":"social","label":"Instagram","alias":"instagram","type":"text","properties":[],"value":null,"normalizedValue":null},"linkedin":{"id":26,"group":"social","label":"LinkedIn","alias":"linkedin","type":"text","properties":[],"value":null,"normalizedValue":null},"skype":{"id":27,"group":"social","label":"Skype","alias":"skype","type":"text","properties":[],"value":null,"normalizedValue":null},"twitter":{"id":28,"group":"social","label":"Twitter","alias":"twitter","type":"text","properties":[],"value":null,"normalizedValue":null}},"personal":[],"professional":[]}},"trackingId":null,"dateSubmitted":"2023-10-11T13:52:10+07:00","referer":"https:\\/\\/am.epacific.net\\/s\\/forms\\/preview\\/41","page":null,"results":{"vi_tri_ung_tuyen2":"DevOps_Eng","ho_ten_day_du_cua_ban":"Nguy\\u1ec5n Quang Huy Test","so_di_dong_cua_ban":"0889920132","email_nhan_ket_qua_tuyen":"nguyenquanghuytest@gmail.com","gioi_thieu_ban_than_khong":"Vi\\u1ec7c gi\\u1edbi thi\\u1ec7u b\\u1ea3n th\\u00e2n kh\\u00f4ng ch\\u1ec9 \\u0111\\u1ec3 nh\\u00e0 tuy\\u1ec3n d\\u1ee5ng n\\u1eafm \\u0111\\u01b0\\u1ee3c nh\\u1eefng th\\u00f4ng tin n\\u1ed5i b\\u1eadt c\\u1ee7a b\\u1ea1n, m\\u00e0 c\\u00f2n \\u0111\\u1ec3 \\u0111\\u00e1nh gi\\u00e1 th\\u00e1i \\u0111\\u1ed9 v\\u00e0 k\\u1ef9 n\\u0103ng tr\\u00ecnh b\\u00e0y c\\u1ee7a b\\u1ea1n. V\\u00ec v\\u1eady, b\\u1ea1n c\\u1ea7n chu\\u1ea9n b\\u1ecb th\\u1eadt k\\u1ef9 tr\\u01b0\\u1edbc ph\\u1ea7n gi\\u1edbi thi\\u1ec7u b\\u1ea3n th\\u00e2n c\\u1ee7a m\\u00ecnh. B\\u1ea1n n\\u00ean gi\\u1eef b\\u00ecnh t\\u0129nh, th\\u00e1i \\u0111\\u1ed9 t\\u1ef1 tin c\\u00f9ng \\u00e1nh m\\u1eaft lu\\u00f4n nh\\u00ecn th\\u1eb3ng v\\u1ec1 ph\\u00eda nh\\u00e0 tuy\\u1ec3n d\\u1ee5ng, tr\\u00e1nh vi\\u1ec7c li\\u1ebfc m\\u1eaft nhi\\u1ec1u n\\u01a1i kh\\u00e1c. N\\u1ebfu \\u0111\\u01b0\\u1ee3c, b\\u1ea1n n\\u00ean k\\u1ebft h\\u1ee3p v\\u1edbi ng\\u00f4n ng\\u1eef c\\u01a1 th\\u1ec3 thay v\\u1ec1 v\\u00ec ng\\u1ed3i im \\u0111\\u1ec3 cho ph\\u1ea7n tr\\u00ecnh b\\u00e0y c\\u1ee7a b\\u1ea1n th\\u00eam ph\\u1ea7n sinh \\u0111\\u1ed9ng v\\u00e0 kh\\u00f4ng \\u0111\\u01a1n \\u0111i\\u1ec7u.  Ngo\\u00e0i ra, b\\u1ea1n n\\u00ean chu\\u1ea9n b\\u1ecb b\\u00e0i gi\\u1edbi thi\\u1ec7u v\\u00e0 t\\u1eadp luy\\u1ec7n t\\u1eeb tr\\u01b0\\u1edbc \\u0111\\u1ec3 tr\\u00e1nh m\\u1eafc l\\u1ed7i khi n\\u00f3i. B\\u00e0i gi\\u1edbi thi\\u1ec7u b\\u1ea3n th\\u00e2n c\\u1ea7n ng\\u1eafn g\\u1ecdn, n\\u00eau l\\u00ean \\u0111\\u01b0\\u1ee3c \\u00fd ch\\u00ednh v\\u00e0 nh\\u1eefng \\u0111i\\u1ec3m n\\u1ed5i b\\u1eadt b\\u1ea1n mu\\u1ed1n nh\\u1eafc \\u0111\\u1ebfn. S\\u1eed d\\u1ee5ng t\\u1eeb ng\\u1eef \\u0111\\u01a1n gi\\u1ea3n v\\u00e0 s\\u1eafp x\\u1ebfp c\\u00e2u ch\\u1eef m\\u1ea1ch l\\u1ea1c \\u0111\\u1ec3 tr\\u00e1nh vi\\u1ec7c c\\u00e2u v\\u0103n b\\u1ecb l\\u1ee7ng c\\u1ee7ng g\\u00e2y kh\\u00f3 hi\\u1ec3u. H\\u01a1n th\\u1ebf n\\u1eefa, b\\u1ea1n n\\u00ean trung th\\u1ef1c v\\u00e0 khi\\u00eam t\\u1ed1n khi gi\\u1edbi thi\\u1ec7u v\\u1ec1 b\\u1ea3n th\\u00e2n cho nh\\u00e0 tuy\\u1ec3n d\\u1ee5ng th\\u1ea5y \\u0111\\u01b0\\u1ee3c t\\u00e1c phong chuy\\u00ean nghi\\u1ec7p trong ph\\u1ea7n gi\\u1edbi thi\\u1ec7u c\\u1ee7a m\\u00ecnh.  \\u0110\\u1ec3 t\\u1ea1o \\u0111\\u01b0\\u1ee3c thi\\u1ec7n c\\u1ea3m v\\u1edbi nh\\u00e0 tuy\\u1ec3n d\\u1ee5ng, khi gi\\u1edbi thi\\u1ec7u b\\u1ea3n th\\u00e2n, b\\u1ea1n n\\u00ean lu\\u00f4n m\\u1ec9m c\\u01b0\\u1eddi v\\u00e0 tr\\u00ecnh b\\u00e0y ch\\u1eadm r\\u00e3i, r\\u00f5 r\\u00e0ng, th\\u1ec3 hi\\u1ec7n \\u0111\\u01b0\\u1ee3c s\\u1ef1 th\\u00e2n thi\\u1ec7n v\\u00e0 ch\\u00e2n th\\u00e0nh khi n\\u00f3i. T\\u1eeb \\u0111\\u00f3, th\\u1ec3 hi\\u1ec7n r\\u00f5 s\\u1ef1 kh\\u00e1c bi\\u1ec7t v\\u1edbi nh\\u1eefng \\u1ee9ng c\\u1eed vi\\u00ean kh\\u00e1c v\\u00e0 thu h\\u00fat \\u0111\\u01b0\\u1ee3c s\\u1ef1 ch\\u00fa \\u00fd c\\u1ee7a nh\\u00e0 tuy\\u1ec3n d\\u1ee5ng trong bu\\u1ed5i ph\\u1ecfng v\\u1ea5n.","cv_cua_ban":"nguyenquanghuy_cv_devops.pdf","label":"T\\u00f4i \\u0111\\u1ed3ng \\u00fd"}},"timestamp":"2023-10-11T13:52:10+07:00"}]}'

print(type(request_data))

request_data_replace_null = re.sub(b"null", b'None', request_data) 

request_data_dict = json.loads(request_data.decode('utf-8'))

form_on_submit = request_data_dict['mautic.form_on_submit'][0]['submission']

submission_id = form_on_submit['id']
contact_id = form_on_submit['lead']['id']
date_submitted = form_on_submit['dateSubmitted']
ip_address = form_on_submit['ipAddress']['ipAddress']
vi_tri_ung_tuyen = form_on_submit['results']['vi_tri_ung_tuyen2']
ho_ten = form_on_submit['results']['ho_ten_day_du_cua_ban']
sdt = form_on_submit['results']['so_di_dong_cua_ban']
email = form_on_submit['results']['email_nhan_ket_qua_tuyen']
gioi_thieu_ban_than = form_on_submit['results']['gioi_thieu_ban_than_khong']
cv_file = form_on_submit['results']['cv_cua_ban']
chinh_sach_va_dieu_khoan = form_on_submit['results']['label']

print(submission_id)
print(contact_id)
print(date_submitted)
print(ip_address)
print(vi_tri_ung_tuyen)


DATABASE_TOKEN = "iFgDQSuA9HIKiUyF9G2oo8I099cIaPJu"

def create_row_baserow(submission_id, contact_id, date_submitted, ip_address, vi_tri_ung_tuyen, ho_ten, sdt, email, gioi_thieu_ban_than, cv_file, chinh_sach_va_dieu_khoan):
    url = "http://178.128.110.168:8080/api/database/rows/table/1156/?user_field_names=true"

    header = {
        "Authorization": f"Token {DATABASE_TOKEN}",
        "Content-Type": "application/json"
    }

    data = { 
        "Submission ID": submission_id,
        "Contact ID": contact_id,
        "Date Submitted": date_submitted,
        "IP address": ip_address,
        "Vị trí ứng tuyển": vi_tri_ung_tuyen,
        "Họ tên đầy đủ của bạn": ho_ten,
        "Số di động của bạn": sdt,
        "Email nhận kết quả tuyển": email,
        "Giới thiệu bản thân (không bắt buộc)": gioi_thieu_ban_than,
        "CV của bạn": cv_file,
        "Chính sách và điều khoản": chinh_sach_va_dieu_khoan
    }

    requests.post(
        url,
        headers=header,
        json= data
    )

create_row_baserow(submission_id, contact_id, date_submitted, ip_address, vi_tri_ung_tuyen, ho_ten, sdt, email, gioi_thieu_ban_than, cv_file, chinh_sach_va_dieu_khoan)